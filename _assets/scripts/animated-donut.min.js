function animateAll(){animateTagLineText(),animateTagIcon(),animateMobileTagLineText(),animateExplanationText(),changeAndMorph(animatedData[donutIndex].donutData),donutIndex===animatedData.length-1?donutIndex=0:donutIndex+=1}function changeAndMorph(a){setPie(),sliceTransition(a),textLabelTransition(a),polylineTransition(a),centerTextTransition()}function midAngle(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function setDonutVars(){donut=d3.select("#animated-plynty-donut").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0,0,"+donutWidth+","+donutHeight).append("g"),donut.append("g").attr("class","slices"),donut.append("g").attr("class","labels"),donut.append("g").attr("class","values"),donut.append("g").attr("class","lines"),donut.append("g").attr("class","center-text"),donut.select("g.center-text").append("text").attr("class","center-line1").attr("text-anchor","middle"),arc=d3.svg.arc().outerRadius(.7*radius).innerRadius(.6*radius),outerArc=d3.svg.arc().innerRadius(.8*radius).outerRadius(.8*radius),donut.attr("transform","translate("+donutWidth/2+","+donutHeight/2+")"),key=function(a){return a.data.label}}function setPie(){startAngle=3*(Math.PI/2),endAngle=7*(Math.PI/2),pie=d3.layout.pie().sort(null).startAngle(startAngle).endAngle(endAngle).padAngle(.03).value(function(a){return a.value})}function sliceTransition(a){var b=donut.select(".slices").selectAll("path.slice").data(pie(a),key);b.enter().insert("path").style("fill",function(a){return colorScale(a.data.label)}).attr("class",function(a){return"slice slice-"+a.data.label}),DONUT_INITIALIZED?b.transition().duration(DURATION).attrTween("d",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return arc(b(a))}}):b.transition().delay(function(a,b){return b*DURATION}).duration(DURATION).attrTween("d",function(a){var b=d3.interpolate(a.startAngle,a.endAngle);return function(c){return a.endAngle=b(c),arc(a)}}),b.exit().remove()}function textLabelTransition(a){var b=donut.select(".labels").selectAll("text").data(pie(a),key);b.enter().append("text").attr("class",function(a){return"text-label label-"+a.data.label}).attr("dy","-0.35em").style("opacity",function(a){return DONUT_INITIALIZED?1:0}).style("fill",function(a){return colorScale(a.data.label)}).style("font-size","1.5em").text(function(a){return a.data.label}),b.transition().delay(function(a,b){return DONUT_INITIALIZED?0:1100*b}).duration(DURATION).attrTween("transform",function(a,b){this._current=this._current||a;var c=d3.interpolate(this._current,a);return this._current=c(0),function(b){donut.select(".text-label.label-"+a.data.label).text(function(){return a.data.label});var d=c(b),e=outerArc.centroid(d);return"income"===a.data.label?e[0]=LABEL_X_POS*(midAngle(d)>2*(Math.PI+.001)?1:-1):"expenses"===a.data.label&&(e[0]=LABEL_X_POS*(midAngle(d)<3*(Math.PI+.001)?1:-1)),"translate("+e+")"}}).styleTween("text-anchor",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(c){var d=b(c);return"income"===a.data.label?midAngle(d)>2*(Math.PI+.001)?"end":"start":"expenses"===a.data.label?midAngle(d)<3*(Math.PI+.001)?"end":"start":void 0}}).style("opacity",1),b.exit().remove()}function polylineTransition(a){var b=0,c=donut.select(".lines").selectAll("polyline").data(pie(a),key);c.enter().append("polyline").attr("class",function(a){return"polyline polyline-"+a.data.label}).style("stroke",function(a){return colorScale(a.data.label)}).style("opacity",function(a){return DONUT_INITIALIZED?.9:0}).style("stroke-width","2px").style("fill","none"),c.transition().each(function(){++b}).delay(function(a,b){return DONUT_INITIALIZED?0:1100*b}).duration(DURATION).attrTween("points",function(a){this._current=this._current||a;var b=d3.interpolate(this._current,a);return this._current=b(0),function(c){var d=b(c),e=outerArc.centroid(d);"income"===a.data.label?e[0]=LABEL_X_POS*(midAngle(d)>2*(Math.PI+.001)?1:-1):"expenses"===a.data.label&&(e[0]=LABEL_X_POS*(midAngle(d)<3*(Math.PI+.001)?1:-1));var f=[arc.centroid(d)[0],arc.centroid(d)[1]];return[f,outerArc.centroid(d),e]}}).style("opacity",.9).each("end",function(){DONUT_INITIALIZED===!1&&0===--b&&(DONUT_INITIALIZED=!0,sliceTransition(a,0))}),c.exit().remove()}function centerTextTransition(){var a=donut.select("text.center-line1");a.attr("dy","0.25em").attr("font-size","2.50em").style("fill",darkGrayTextColor).style("opacity",function(){return DONUT_INITIALIZED?1:0}).text(function(){return"cashflow"}),a.transition().duration(function(){return DONUT_INITIALIZED?0:1500}).style("opacity",1)}function animateTagLineText(){var a=d3.select("#tagline-step-"+donutIndex);a.transition().duration(DURATION).style("opacity",1).style("color",incomeColor),a.transition().delay(INTERVAL_DURATION).duration(DURATION).style("opacity",.87).style("color","#217269")}function animateTagIcon(){var a=d3.select("#tagicon-"+donutIndex);a.transition().duration(DURATION).style("opacity",1),a.transition().delay(INTERVAL_DURATION).duration(DURATION).style("opacity",0)}function animateMobileTagLineText(){var a=d3.select("#tagline-mobile-step-"+donutIndex);a.transition().duration(DURATION).style("display","block").style("opacity",1).style("color",incomeColor),a.transition().delay(INTERVAL_DURATION-DURATION).duration(DURATION).style("opacity",0).transition().style("display","none")}function animateExplanationText(){var a=d3.select("#explanation-step-"+donutIndex);a.transition().duration(DURATION).style("display","block").style("opacity",1),a.transition().delay(INTERVAL_DURATION-DURATION).duration(DURATION).style("opacity",0).transition().style("display","none")}function getData(){return[{step:0,donutData:[{label:"income",value:50},{label:"expenses",value:50}],tagLine:"how much will you need?",explanation:"A simple household budget --\nthe balance of what you earn and spend.\nThat's how plynty helps you plan for retirement.",donutType:"balanced"},{step:1,donutData:[{label:"income",value:25},{label:"expenses",value:75}],tagLine:"when will you retire?",explanation:"What if you retire early?\nHow will it change the lifestyle you want to live?\nplynty makes smart choices simple.",donutType:"income only 1/4"},{step:2,donutData:[{label:"income",value:40},{label:"expenses",value:60}],tagLine:"smarter saving for a better life",explanation:"A saving and investing strategy that minimizes fees.\nHow much more could you have?\nplynty helps you keep more.",donutType:"income only 1/3"},{step:3,donutData:[{label:"income",value:50},{label:"expenses",value:50}],tagLine:"what if?",explanation:"Which spending changes in get you closest to your lifestyle goal?\nAnswering that question is the power of plynty.",donutType:"balanced"},{step:4,donutData:[{label:"income",value:70},{label:"expenses",value:30}],tagLine:"what will you do?",explanation:"Work part-time, if only for the fun of it.\nWhether working for pay or volunteering for charity,\nStaying active is the key to lifelong happiness.",donutType:"income 2/3"},{step:5,donutData:[{label:"income",value:50},{label:"expenses",value:50}],tagLine:"how will you spend your retirement?",explanation:"Enjoying family, travel, hobbies?\nPlynty helps you fund your dreams",donutType:"balanced"}]}var DONUT_INITIALIZED=!1,DURATION=1e3,INTERVAL_DURATION=9e3,incomeColor="#3ebeb0",expensesColor="#134e75",darkGrayTextColor="#606060",colorScale=d3.scale.ordinal().domain(["income","expenses"]).range([incomeColor,expensesColor]),animatedData=getData(),donutIndex=0,donutWidth=700,donutHeight=450,radius=Math.min(donutWidth,donutHeight)/2,LABEL_X_POS=1.24*radius,donut,pie,startAngle,endAngle,arc,outerArc,key;setDonutVars(),animateAll();var runAnimation=setInterval(animateAll,INTERVAL_DURATION);